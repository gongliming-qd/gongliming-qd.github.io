function e(){var e=Object.create(null);function n(t,o){var a=t.id,i=t.name,u=t.dependencies;void 0===u&&(u=[]);var s=t.init;void 0===s&&(s=function(){});var c=t.getTransferables;if(void 0===c&&(c=null),!e[a])try{u=u.map((function(r){return r&&r.isWorkerModule&&(n(r,(function(e){if(e instanceof Error)throw e})),r=e[r.id].value),r})),s=r("<"+i+">.init",s),c&&(c=r("<"+i+">.getTransferables",c));var l=null;"function"==typeof s&&(l=s.apply(void 0,u)),e[a]={id:a,value:l,getTransferables:c},o(l)}catch(f){!f||f.noLog,o(f)}}function r(e,n){var r=void 0;self.troikaDefine=function(e){return r=e};var t=URL.createObjectURL(new Blob(["/** "+e.replace(/\*/g,"")+" **/\n\ntroikaDefine(\n"+n+"\n)"],{type:"application/javascript"}));try{importScripts(t)}catch(o){}return URL.revokeObjectURL(t),delete self.troikaDefine,r}self.addEventListener("message",(function(r){var t=r.data,o=t.messageId,a=t.action,i=t.data;try{"registerModule"===a&&n(i,(function(e){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:{isCallable:"function"==typeof e}})})),"callModule"===a&&function(n,r){var t,o=n.id,a=n.args;e[o]&&"function"==typeof e[o].value||r(new Error("Worker module "+o+": not found or its 'init' did not return a function"));try{var i=(t=e[o]).value.apply(t,a);i&&"function"==typeof i.then?i.then(u,(function(e){return r(e instanceof Error?e:new Error(""+e))})):u(i)}catch(s){r(s)}function u(n){try{var t=e[o].getTransferables&&e[o].getTransferables(n);t&&Array.isArray(t)&&t.length||(t=void 0),r(n,t)}catch(s){r(s)}}}(i,(function(e,n){e instanceof Error?postMessage({messageId:o,success:!1,error:e.message}):postMessage({messageId:o,success:!0,result:e},n||void 0)}))}catch(u){postMessage({messageId:o,success:!1,error:u.stack})}}))}var n=function(){var e=!1;if("undefined"!=typeof window&&void 0!==window.document)try{new Worker(URL.createObjectURL(new Blob([""],{type:"application/javascript"}))).terminate(),e=!0}catch(r){0}return n=function(){return e},e},r=0,t=0,o=!1,a=Object.create(null),i=Object.create(null),u=Object.create(null);function s(e){if(!(e&&"function"==typeof e.init||o))throw new Error("requires `options.init` function");var t=e.dependencies,a=e.init,u=e.getTransferables,c=e.workerId;if(!n())return function(e){var n=function(){for(var e=[],r=arguments.length;r--;)e[r]=arguments[r];return n._getInitResult().then((function(n){if("function"==typeof n)return n.apply(void 0,e);throw new Error("Worker module function was called but `init` did not return a callable function")}))};return n._getInitResult=function(){var r=e.dependencies,t=e.init;r=Array.isArray(r)?r.map((function(e){return e&&e._getInitResult?e._getInitResult():e})):[];var o=Promise.all(r).then((function(e){return t.apply(null,e)}));return n._getInitResult=function(){return o},o},n}(e);null==c&&(c="#default");var d="workerModule"+ ++r,p=e.name||d,v=null;function g(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];if(!v){v=f(c,"registerModule",g.workerModuleData);var r=function(){v=null,i[c].delete(r)};(i[c]||(i[c]=new Set)).add(r)}return v.then((function(n){if(n.isCallable)return f(c,"callModule",{id:d,args:e});throw new Error("Worker module function was called but `init` did not return a callable function")}))}return t=t&&t.map((function(e){return"function"!=typeof e||e.workerModuleData||(o=!0,e=s({workerId:c,name:"<"+p+"> function dependency: "+e.name,init:"function(){return (\n"+l(e)+"\n)}"}),o=!1),e&&e.workerModuleData&&(e=e.workerModuleData),e})),g.workerModuleData={isWorkerModule:!0,id:d,name:p,dependencies:t,init:l(a),getTransferables:u&&l(u)},g}function c(e){i[e]&&i[e].forEach((function(e){e()})),a[e]&&(a[e].terminate(),delete a[e])}function l(e){var n=e.toString();return!/^function/.test(n)&&/^\w+\s*\(/.test(n)&&(n="function "+n),n}function f(n,r,o){return new Promise((function(i,s){var c=++t;u[c]=function(e){e.success?i(e.result):s(new Error("Error in worker "+r+" call: "+e.error))},function(n){var r=a[n];if(!r){var t=l(e);(r=a[n]=new Worker(URL.createObjectURL(new Blob(["/** Worker Module Bootstrap: "+n.replace(/\*/g,"")+" **/\n\n;("+t+")()"],{type:"application/javascript"})))).onmessage=function(e){var n=e.data,r=n.messageId,t=u[r];if(!t)throw new Error("WorkerModule response with empty or unknown messageId");delete u[r],t(n)}}return r}(n).postMessage({messageId:c,action:r,data:o})}))}export{s as d,c as t};
