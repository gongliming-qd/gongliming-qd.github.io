function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
import{r as e,j as t,R as n}from"./glm-react-B-zrKVhV.js";import{L as r,T as o,R as i,U as a,a as s,O as l,P as c,S as u,b as d,N as f,A as p,B as m,M as v,C as h,V as g,c as y,W as b,d as w,e as E,f as x,g as C,h as M,i as j,j as S,D as _,k as P,l as k,Q as O,m as R,n as A,o as I,E as F,p as T}from"./glm-three-CTgrlxYM.js";import{j as z}from"./glm-react-use-measure-Cm5Kbva5.js";import{F as D,u as L}from"./glm-its-fine-DUMEFrq2.js";import{R as B,c as W}from"./glm-react-reconciler-m_n2uYp5.js";import"./glm-react-dom-YOCEErA7.js";import{c as N,s as q}from"./glm-zustand-DVvah3ZO.js";import{_ as U}from"./glm-@babel-DPdBf6DS.js";import{T as H,p as V}from"./glm-troika-three-text-ZdyYsGYH.js";import{s as G,p as $,c as Y}from"./glm-suspend-react-C6SjTaXM.js";import{P as X,S as Q}from"./glm-three-stdlib-Bt210Q1w.js";import{Vector3 as Z,ColliderDesc as K,ActiveEvents as J,EventQueue as ee,RigidBodyDesc as te}from"./glm-@dimforge-C9UPVe2M.js";import{u as ne}from"./glm-use-asset-BAr_m-rA.js";const re={},oe=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){const e=document.getElementsByTagName("link");r=Promise.all(t.map((t=>{if((t=function(e){return"/personal-site/"+e}(t))in re)return;re[t]=!0;const r=t.endsWith(".css"),o=r?'[rel="stylesheet"]':"";if(!!n)for(let n=e.length-1;n>=0;n--){const o=e[n];if(o.href===t&&(!r||"stylesheet"===o.rel))return}else if(document.querySelector(`link[href="${t}"]${o}`))return;const i=document.createElement("link");return i.rel=r?"stylesheet":"modulepreload",r||(i.as="script",i.crossOrigin=""),i.href=t,document.head.appendChild(i),r?new Promise(((e,n)=>{i.addEventListener("load",e),i.addEventListener("error",(()=>n(new Error(`Unable to preload CSS for ${t}`))))})):void 0})))}return r.then((()=>e())).catch((e=>{const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}))};var ie={exports:{}},ae={};
/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
!function(e){function t(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,i=e[r];if(!(0<o(i,t)))break e;e[r]=t,e[n]=i,n=r}}function n(e){return 0===e.length?null:e[0]}function r(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,i=e.length,a=i>>>1;r<a;){var s=2*(r+1)-1,l=e[s],c=s+1,u=e[c];if(0>o(l,n))c<i&&0>o(u,l)?(e[r]=u,e[c]=n,r=c):(e[r]=l,e[s]=n,r=s);else{if(!(c<i&&0>o(u,n)))break e;e[r]=u,e[c]=n,r=c}}}return t}function o(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"==typeof performance&&"function"==typeof performance.now){var i=performance;e.unstable_now=function(){return i.now()}}else{var a=Date,s=a.now();e.unstable_now=function(){return a.now()-s}}var l=[],c=[],u=1,d=null,f=3,p=!1,m=!1,v=!1,h="function"==typeof setTimeout?setTimeout:null,g="function"==typeof clearTimeout?clearTimeout:null,y="undefined"!=typeof setImmediate?setImmediate:null;function b(e){for(var o=n(c);null!==o;){if(null===o.callback)r(c);else{if(!(o.startTime<=e))break;r(c),o.sortIndex=o.expirationTime,t(l,o)}o=n(c)}}function w(e){if(v=!1,b(e),!m)if(null!==n(l))m=!0,A(E);else{var t=n(c);null!==t&&I(w,t.startTime-e)}}function E(t,o){m=!1,v&&(v=!1,g(j),j=-1),p=!0;var i=f;try{for(b(o),d=n(l);null!==d&&(!(d.expirationTime>o)||t&&!P());){var a=d.callback;if("function"==typeof a){d.callback=null,f=d.priorityLevel;var s=a(d.expirationTime<=o);o=e.unstable_now(),"function"==typeof s?d.callback=s:d===n(l)&&r(l),b(o)}else r(l);d=n(l)}if(null!==d)var u=!0;else{var h=n(c);null!==h&&I(w,h.startTime-o),u=!1}return u}finally{d=null,f=i,p=!1}}"undefined"!=typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var x,C=!1,M=null,j=-1,S=5,_=-1;function P(){return!(e.unstable_now()-_<S)}function k(){if(null!==M){var t=e.unstable_now();_=t;var n=!0;try{n=M(!0,t)}finally{n?x():(C=!1,M=null)}}else C=!1}if("function"==typeof y)x=function(){y(k)};else if("undefined"!=typeof MessageChannel){var O=new MessageChannel,R=O.port2;O.port1.onmessage=k,x=function(){R.postMessage(null)}}else x=function(){h(k,0)};function A(e){M=e,C||(C=!0,x())}function I(t,n){j=h((function(){t(e.unstable_now())}),n)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(e){e.callback=null},e.unstable_continueExecution=function(){m||p||(m=!0,A(E))},e.unstable_forceFrameRate=function(e){0>e||125<e||(S=0<e?Math.floor(1e3/e):5)},e.unstable_getCurrentPriorityLevel=function(){return f},e.unstable_getFirstCallbackNode=function(){return n(l)},e.unstable_next=function(e){switch(f){case 1:case 2:case 3:var t=3;break;default:t=f}var n=f;f=t;try{return e()}finally{f=n}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=f;f=e;try{return t()}finally{f=n}},e.unstable_scheduleCallback=function(r,o,i){var a=e.unstable_now();switch("object"==typeof i&&null!==i?i="number"==typeof(i=i.delay)&&0<i?a+i:a:i=a,r){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return r={id:u++,callback:o,priorityLevel:r,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>a?(r.sortIndex=i,t(c,r),null===n(l)&&r===n(c)&&(v?(g(j),j=-1):v=!0,I(w,i-a))):(r.sortIndex=s,t(l,r),m||p||(m=!0,A(E))),r},e.unstable_shouldYield=P,e.unstable_wrapCallback=function(e){var t=f;return function(){var n=f;f=t;try{return e.apply(this,arguments)}finally{f=n}}}}(ae),ie.exports=ae;var se=ie.exports;const le={},ce=e=>{Object.assign(le,e)};var ue,de;const fe=e=>"colorSpace"in e||"outputColorSpace"in e,pe=()=>{var e;return null!=(e=le.ColorManagement)?e:null},me=e=>e&&e.isOrthographicCamera,ve="undefined"!=typeof window&&(null!=(ue=window.document)&&ue.createElement||"ReactNative"===(null==(de=window.navigator)?void 0:de.product))?e.useLayoutEffect:e.useEffect;function he(t){const n=e.useRef(t);return ve((()=>{n.current=t}),[t]),n}function ge({set:e}){return ve((()=>(e(new Promise((()=>null))),()=>e(!1))),[e]),null}class ye extends e.Component{constructor(...e){super(...e),this.state={error:!1}}componentDidCatch(e){this.props.set(e)}render(){return this.state.error?null:this.props.children}}ye.getDerivedStateFromError=()=>({error:!0});const be="__default",we=new Map,Ee=e=>e&&!!e.memoized&&!!e.changes;function xe(e){var t;const n="undefined"!=typeof window?null!=(t=window.devicePixelRatio)?t:2:1;return Array.isArray(e)?Math.min(Math.max(e[0],n),e[1]):e}const Ce=e=>{var t;return null==(t=e.__r3f)?void 0:t.root.getState()};function Me(e){let t=e.__r3f.root;for(;t.getState().previousRoot;)t=t.getState().previousRoot;return t}const je={obj:e=>e===Object(e)&&!je.arr(e)&&"function"!=typeof e,fun:e=>"function"==typeof e,str:e=>"string"==typeof e,num:e=>"number"==typeof e,boo:e=>"boolean"==typeof e,und:e=>void 0===e,arr:e=>Array.isArray(e),equ(e,t,{arrays:n="shallow",objects:r="reference",strict:o=!0}={}){if(typeof e!=typeof t||!!e!=!!t)return!1;if(je.str(e)||je.num(e)||je.boo(e))return e===t;const i=je.obj(e);if(i&&"reference"===r)return e===t;const a=je.arr(e);if(a&&"reference"===n)return e===t;if((a||i)&&e===t)return!0;let s;for(s in e)if(!(s in t))return!1;if(i&&"shallow"===n&&"shallow"===r){for(s in o?t:e)if(!je.equ(e[s],t[s],{strict:o,objects:"reference"}))return!1}else for(s in o?t:e)if(e[s]!==t[s])return!1;if(je.und(s)){if(a&&0===e.length&&0===t.length)return!0;if(i&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function Se(e,t){return e.__r3f={type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null,...t},e}function _e(e,t){let n=e;if(t.includes("-")){const r=t.split("-"),o=r.pop();return n=r.reduce(((e,t)=>e[t]),e),{target:n,key:o}}return{target:n,key:t}}const Pe=/-\d+$/;function ke(e,t,n){if(je.str(n)){if(Pe.test(n)){const t=n.replace(Pe,""),{target:r,key:o}=_e(e,t);Array.isArray(r[o])||(r[o]=[])}const{target:r,key:o}=_e(e,n);t.__r3f.previousAttach=r[o],r[o]=t}else t.__r3f.previousAttach=n(e,t)}function Oe(e,t,n){var r,o;if(je.str(n)){const{target:r,key:o}=_e(e,n),i=t.__r3f.previousAttach;void 0===i?delete r[o]:r[o]=i}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(o=t.__r3f)||delete o.previousAttach}function Re(e,{children:t,key:n,ref:r,...o},{children:i,key:a,ref:s,...l}={},c=!1){const u=e.__r3f,d=Object.entries(o),f=[];if(c){const e=Object.keys(l);for(let t=0;t<e.length;t++)o.hasOwnProperty(e[t])||d.unshift([e[t],be+"remove"])}d.forEach((([t,n])=>{var r;if(null!=(r=e.__r3f)&&r.primitive&&"object"===t)return;if(je.equ(n,l[t]))return;if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(t))return f.push([t,n,!0,[]]);let i=[];t.includes("-")&&(i=t.split("-")),f.push([t,n,!1,i]);for(const e in o){const n=o[e];e.startsWith(`${t}-`)&&f.push([e,n,!1,e.split("-")])}}));const p={...o};return null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.args&&(p.args=u.memoizedProps.args),null!=u&&u.memoizedProps&&null!=u&&u.memoizedProps.attach&&(p.attach=u.memoizedProps.attach),{memoized:p,changes:f}}const Ae="undefined"!=typeof process&&!1;function Ie(e,t){var n;const s=e.__r3f,l=null==s?void 0:s.root,c=null==l||null==l.getState?void 0:l.getState(),{memoized:u,changes:d}=Ee(t)?t:Re(e,t),f=null==s?void 0:s.eventCount;e.__r3f&&(e.__r3f.memoizedProps=u);for(let p=0;p<d.length;p++){let[t,n,l,u]=d[p];if(fe(e)){const e=3001,r="srgb",o="srgb-linear";"encoding"===t?(t="colorSpace",n=n===e?r:o):"outputEncoding"===t&&(t="outputColorSpace",n=n===e?r:o)}let f=e,m=f[t];if(u.length&&(m=u.reduce(((e,t)=>e[t]),e),!m||!m.set)){const[n,...r]=u.reverse();f=r.reverse().reduce(((e,t)=>e[t]),e),t=n}if(n===be+"remove")if(f.constructor){let e=we.get(f.constructor);e||(e=new f.constructor,we.set(f.constructor,e)),n=e[t]}else n=0;if(l&&s)n?s.handlers[t]=n:delete s.handlers[t],s.eventCount=Object.keys(s.handlers).length;else if(m&&m.set&&(m.copy||m instanceof r)){if(Array.isArray(n))m.fromArray?m.fromArray(n):m.set(...n);else if(m.copy&&n&&n.constructor&&(Ae?m.constructor.name===n.constructor.name:m.constructor===n.constructor))m.copy(n);else if(void 0!==n){const e=m instanceof h;!e&&m.setScalar?m.setScalar(n):m instanceof r&&n instanceof r?m.mask=n.mask:m.set(n),!pe()&&c&&!c.linear&&e&&m.convertSRGBToLinear()}}else if(f[t]=n,f[t]instanceof o&&f[t].format===i&&f[t].type===a&&c){const e=f[t];fe(e)&&fe(c.gl)?e.colorSpace=c.gl.outputColorSpace:e.encoding=c.gl.outputEncoding}Fe(e)}if(s&&s.parent&&e.raycast&&f!==s.eventCount){const t=Me(e).getState().internal,n=t.interaction.indexOf(e);n>-1&&t.interaction.splice(n,1),s.eventCount&&t.interaction.push(e)}return!(1===d.length&&"onUpdate"===d[0][0])&&d.length&&null!=(n=e.__r3f)&&n.parent&&Te(e),e}function Fe(e){var t,n;const r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function Te(e){null==e.onUpdate||e.onUpdate(e)}function ze(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function De(e,t,n,r){const o=n.get(t);o&&(n.delete(t),0===n.size&&(e.delete(r),o.target.releasePointerCapture(r)))}function Le(e){function t(e){return e.filter((e=>["Move","Over","Enter","Out","Leave"].some((t=>{var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))))}function n(t){const{internal:n}=e.getState();for(const e of n.hovered.values())if(!t.length||!t.find((t=>t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId))){const r=e.eventObject.__r3f,o=null==r?void 0:r.handlers;if(n.hovered.delete(ze(e)),null!=r&&r.eventCount){const n={...e,intersections:t};null==o.onPointerOut||o.onPointerOut(n),null==o.onPointerLeave||o.onPointerLeave(n)}}}function r(e,t){for(let n=0;n<t.length;n++){const r=t[n].__r3f;null==r||null==r.handlers.onPointerMissed||r.handlers.onPointerMissed(e)}}return{handlePointer:function(o){switch(o){case"onPointerLeave":case"onPointerCancel":return()=>n([]);case"onLostPointerCapture":return t=>{const{internal:r}=e.getState();"pointerId"in t&&r.capturedMap.has(t.pointerId)&&requestAnimationFrame((()=>{r.capturedMap.has(t.pointerId)&&(r.capturedMap.delete(t.pointerId),n([]))}))}}return function(i){const{onPointerMissed:a,internal:s}=e.getState();s.lastEvent.current=i;const l="onPointerMove"===o,c="onClick"===o||"onContextMenu"===o||"onDoubleClick"===o,u=function(t,n){const r=e.getState(),o=new Set,i=[],a=n?n(r.internal.interaction):r.internal.interaction;for(let e=0;e<a.length;e++){const t=Ce(a[e]);t&&(t.raycaster.camera=void 0)}r.previousRoot||null==r.events.compute||r.events.compute(t,r);let s=a.flatMap((function(e){const n=Ce(e);return n&&n.events.enabled&&null!==n.raycaster.camera?(void 0===n.raycaster.camera&&(null==n.events.compute||n.events.compute(t,n,null==(r=n.previousRoot)?void 0:r.getState()),void 0===n.raycaster.camera&&(n.raycaster.camera=null)),n.raycaster.camera?n.raycaster.intersectObject(e,!0):[]):[];var r})).sort(((e,t)=>{const n=Ce(e.object),r=Ce(t.object);return n&&r&&r.events.priority-n.events.priority||e.distance-t.distance})).filter((e=>{const t=ze(e);return!o.has(t)&&(o.add(t),!0)}));r.events.filter&&(s=r.events.filter(s,r));for(const e of s){let t=e.object;for(;t;){var l;null!=(l=t.__r3f)&&l.eventCount&&i.push({...e,eventObject:t}),t=t.parent}}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId))for(let e of r.internal.capturedMap.get(t.pointerId).values())o.has(ze(e.intersection))||i.push(e.intersection);return i}(i,l?t:void 0),d=c?function(t){const{internal:n}=e.getState(),r=t.offsetX-n.initialClick[0],o=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+o*o))}(i):0;"onPointerDown"===o&&(s.initialClick=[i.offsetX,i.offsetY],s.initialHits=u.map((e=>e.eventObject))),c&&!u.length&&d<=2&&(r(i,s.interaction),a&&a(i)),l&&n(u),function(t,r,o,i){const a=e.getState();if(t.length){const e={stopped:!1};for(const s of t){const l=Ce(s.object)||a,{raycaster:c,pointer:u,camera:d,internal:f}=l,p=new g(u.x,u.y,0).unproject(d),m=e=>{var t,n;return null!=(t=null==(n=f.capturedMap.get(e))?void 0:n.has(s.eventObject))&&t},v=e=>{const t={intersection:s,target:r.target};f.capturedMap.has(e)?f.capturedMap.get(e).set(s.eventObject,t):f.capturedMap.set(e,new Map([[s.eventObject,t]])),r.target.setPointerCapture(e)},h=e=>{const t=f.capturedMap.get(e);t&&De(f.capturedMap,s.eventObject,t,e)};let y={};for(let e in r){let t=r[e];"function"!=typeof t&&(y[e]=t)}let b={...s,...y,pointer:u,intersections:t,stopped:e.stopped,delta:o,unprojectedPoint:p,ray:c.ray,camera:d,stopPropagation(){const o="pointerId"in r&&f.capturedMap.get(r.pointerId);(!o||o.has(s.eventObject))&&(b.stopped=e.stopped=!0,f.hovered.size&&Array.from(f.hovered.values()).find((e=>e.eventObject===s.eventObject)))&&n([...t.slice(0,t.indexOf(s)),s])},target:{hasPointerCapture:m,setPointerCapture:v,releasePointerCapture:h},currentTarget:{hasPointerCapture:m,setPointerCapture:v,releasePointerCapture:h},nativeEvent:r};if(i(b),!0===e.stopped)break}}}(u,i,d,(function(e){const t=e.eventObject,n=t.__r3f,a=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(a.onPointerOver||a.onPointerEnter||a.onPointerOut||a.onPointerLeave){const t=ze(e),n=s.hovered.get(t);n?n.stopped&&e.stopPropagation():(s.hovered.set(t,e),null==a.onPointerOver||a.onPointerOver(e),null==a.onPointerEnter||a.onPointerEnter(e))}null==a.onPointerMove||a.onPointerMove(e)}else{const n=a[o];n?c&&!s.initialHits.includes(t)||(r(i,s.interaction.filter((e=>!s.initialHits.includes(e)))),n(e)):c&&s.initialHits.includes(t)&&r(i,s.interaction.filter((e=>!s.initialHits.includes(e))))}}))}}}}const Be=e=>!(null==e||!e.render),We=e.createContext(null),Ne=(t,n)=>{const r=N(((r,o)=>{const i=new g,a=new g,s=new g;function l(e=o().camera,t=a,n=o().size){const{width:r,height:l,top:c,left:u}=n,d=r/l;t instanceof g?s.copy(t):s.set(...t);const f=e.getWorldPosition(i).distanceTo(s);if(me(e))return{width:r/e.zoom,height:l/e.zoom,top:c,left:u,factor:1,distance:f,aspect:d};{const t=e.fov*Math.PI/180,n=2*Math.tan(t/2)*f,o=n*(r/l);return{width:o,height:n,top:c,left:u,factor:r/o,distance:f,aspect:d}}}let c;const u=e=>r((t=>({performance:{...t.performance,current:e}}))),d=new y;return{set:r,get:o,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,scene:null,invalidate:(e=1)=>t(o(),e),advance:(e,t)=>n(e,t,o()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new M,pointer:d,mouse:d,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const e=o();c&&clearTimeout(c),e.performance.current!==e.performance.min&&u(e.performance.min),c=setTimeout((()=>u(o().performance.max)),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:l},setEvents:e=>r((t=>({...t,events:{...t.events,...e}}))),setSize:(e,t,n,i,s)=>{const c=o().camera,u={width:e,height:t,top:i||0,left:s||0,updateStyle:n};r((e=>({size:u,viewport:{...e.viewport,...l(c,a,u)}})))},setDpr:e=>r((t=>{const n=xe(e);return{viewport:{...t.viewport,dpr:n,initialDpr:t.viewport.initialDpr||n}}})),setFrameloop:(e="always")=>{const t=o().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),r((()=>({frameloop:e})))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:e.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:(e,t,n)=>{const r=o().internal;return r.priority=r.priority+(t>0?1:0),r.subscribers.push({ref:e,priority:t,store:n}),r.subscribers=r.subscribers.sort(((e,t)=>e.priority-t.priority)),()=>{const n=o().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter((t=>t.ref!==e)))}}}}})),o=r.getState();let i=o.size,a=o.viewport.dpr,s=o.camera;return r.subscribe((()=>{const{camera:e,size:t,viewport:n,gl:o,set:l}=r.getState();if(t.width!==i.width||t.height!==i.height||n.dpr!==a){var c;i=t,a=n.dpr,function(e,t){e.manual||(me(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}(e,t),o.setPixelRatio(n.dpr);const r=null!=(c=t.updateStyle)?c:"undefined"!=typeof HTMLCanvasElement&&o.domElement instanceof HTMLCanvasElement;o.setSize(t.width,t.height,r)}e!==s&&(s=e,l((t=>({viewport:{...t.viewport,...t.viewport.getCurrentViewport(e)}}))))})),r.subscribe((e=>t(e))),r};let qe,Ue,He,Ve=new Set,Ge=new Set,$e=new Set;function Ye(e,t){if(e.size)for(const{callback:n}of e.values())n(t)}function Xe(e,t){switch(e){case"before":return Ye(Ve,t);case"after":return Ye(Ge,t);case"tail":return Ye($e,t)}}function Qe(e,t,n){let r=t.clock.getDelta();for("never"===t.frameloop&&"number"==typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),Ue=t.internal.subscribers,qe=0;qe<Ue.length;qe++)He=Ue[qe],He.ref.current(He.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function Ze(){const t=e.useContext(We);if(!t)throw new Error("R3F: Hooks can only be used within the Canvas component!");return t}function Ke(e=(e=>e),t){return Ze()(e,t)}function Je(e,t=0){const n=Ze(),r=n.getState().internal.subscribe,o=he(e);return ve((()=>r(o,t,n)),[t,r,n]),null}const et=new WeakMap;function tt(e,t){return function(n,...r){let o=et.get(n);return o||(o=new n,et.set(n,o)),e&&e(o),Promise.all(r.map((e=>new Promise(((n,r)=>o.load(e,(e=>{e.scene&&Object.assign(e,function(e){const t={nodes:{},materials:{}};return e&&e.traverse((e=>{e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}(e.scene)),n(e)}),t,(t=>r(new Error(`Could not load ${e}: ${null==t?void 0:t.message}`)))))))))}}function nt(e,t,n,r){const o=Array.isArray(t)?t:[t],i=G(tt(n,r),[e,...o],{equal:je.equ});return Array.isArray(t)?i:i[0]}nt.preload=function(e,t,n){const r=Array.isArray(t)?t:[t];return $(tt(n),[e,...r])},nt.clear=function(e,t){const n=Array.isArray(t)?t:[t];return Y([e,...n])};const rt=new Map,{invalidate:ot,advance:it}=function(e){let t,n,r,o=!1,i=!1;function a(s){n=requestAnimationFrame(a),o=!0,t=0,Xe("before",s),i=!0;for(const n of e.values()){var l;r=n.store.getState(),!r.internal.active||!("always"===r.frameloop||r.internal.frames>0)||null!=(l=r.gl.xr)&&l.isPresenting||(t+=Qe(s,r))}if(i=!1,Xe("after",s),0===t)return Xe("tail",s),o=!1,cancelAnimationFrame(n)}return{loop:a,invalidate:function t(n,r=1){var s;if(!n)return e.forEach((e=>t(e.store.getState(),r)));null!=(s=n.gl.xr)&&s.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=r>1?Math.min(60,n.internal.frames+r):i?2:1,o||(o=!0,requestAnimationFrame(a)))},advance:function(t,n=!0,r,o){if(n&&Xe("before",t),r)Qe(t,r,o);else for(const i of e.values())Qe(t,i.store.getState());n&&Xe("after",t)}}}(rt),{reconciler:at,applyProps:st}=function(e,t){function n(e,{args:t=[],attach:n,...r},o){let i,a=`${e[0].toUpperCase()}${e.slice(1)}`;if("primitive"===e){if(void 0===r.object)throw new Error("R3F: Primitives without 'object' are invalid!");i=Se(r.object,{type:e,root:o,attach:n,primitive:!0})}else{const r=le[a];if(!r)throw new Error(`R3F: ${a} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(!Array.isArray(t))throw new Error("R3F: The args prop must be an array!");i=Se(new r(...t),{type:e,root:o,attach:n,memoizedProps:{args:t}})}return void 0===i.__r3f.attach&&(i instanceof m?i.__r3f.attach="geometry":i instanceof v&&(i.__r3f.attach="material")),"inject"!==a&&Ie(i,r),i}function r(e,t){let n=!1;var r,o;t&&(null!=(r=t.__r3f)&&r.attach?ke(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),n=!0),n||null==(o=e.__r3f)||o.objects.push(t),t.__r3f||Se(t,{}),t.__r3f.parent=e,Te(t),Fe(t))}function o(e,t,n){let r=!1;if(t){var o,i;if(null!=(o=t.__r3f)&&o.attach)ke(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"}),e.dispatchEvent({type:"childadded",child:t});const o=e.children.filter((e=>e!==t)),i=o.indexOf(n);e.children=[...o.slice(0,i),t,...o.slice(i)],r=!0}r||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||Se(t,{}),t.__r3f.parent=e,Te(t),Fe(t)}}function i(e,t,n=!1){e&&[...e].forEach((e=>a(t,e,n)))}function a(e,t,n){if(t){var r,o,a;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter((e=>e!==t))),null!=(o=t.__r3f)&&o.attach)Oe(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&function(e,t){const{internal:n}=e.getState();n.interaction=n.interaction.filter((e=>e!==t)),n.initialHits=n.initialHits.filter((e=>e!==t)),n.hovered.forEach(((e,r)=>{e.eventObject!==t&&e.object!==t||n.hovered.delete(r)})),n.capturedMap.forEach(((e,r)=>{De(n.capturedMap,t,e,r)}))}(Me(t),t)}const c=null==(a=t.__r3f)?void 0:a.primitive,u=!c&&(void 0===n?null!==t.dispose:n);var l;if(!c)i(null==(l=t.__r3f)?void 0:l.objects,t,u),i(t.children,t,u);if(delete t.__r3f,u&&t.dispose&&"Scene"!==t.type){const e=()=>{try{t.dispose()}catch(e){}};"undefined"==typeof IS_REACT_ACT_ENVIRONMENT?se.unstable_scheduleCallback(se.unstable_IdlePriority,e):e()}Fe(e)}}const s=()=>{};return{reconciler:B({createInstance:n,removeChild:a,appendChild:r,appendInitialChild:r,insertBefore:o,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:(e,t)=>{if(!t)return;const n=e.getState().scene;n.__r3f&&(n.__r3f.root=e,r(n,t))},removeChildFromContainer:(e,t)=>{t&&a(e.getState().scene,t)},insertInContainerBefore:(e,t,n)=>{if(!t||!n)return;const r=e.getState().scene;r.__r3f&&o(r,t,n)},getRootHostContext:()=>null,getChildHostContext:e=>e,finalizeInitialChildren(e){var t;const n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate(e,t,n,r){var o;if((null!=(o=null==e?void 0:e.__r3f)?o:{}).primitive&&r.object&&r.object!==e)return[!0];{const{args:t=[],children:o,...i}=r,{args:a=[],children:s,...l}=n;if(!Array.isArray(t))throw new Error("R3F: the args prop must be an array!");if(t.some(((e,t)=>e!==a[t])))return[!0];const c=Re(e,i,l,!0);return c.changes.length?[!1,c]:null}},commitUpdate(e,[t,o],i,s,l,c){t?function(e,t,o,i){var s;const l=null==(s=e.__r3f)?void 0:s.parent;if(!l)return;const c=n(t,o,e.__r3f.root);if(e.children){for(const t of e.children)t.__r3f&&r(c,t);e.children=e.children.filter((e=>!e.__r3f))}e.__r3f.objects.forEach((e=>r(c,e))),e.__r3f.objects=[],e.__r3f.autoRemovedBeforeAppend||a(l,e),c.parent&&(c.__r3f.autoRemovedBeforeAppend=!0),r(l,c),c.raycast&&c.__r3f.eventCount&&Me(c).getState().internal.interaction.push(c);[i,i.alternate].forEach((e=>{null!==e&&(e.stateNode=c,e.ref&&("function"==typeof e.ref?e.ref(c):e.ref.current=c))}))}(e,i,l,c):Ie(e,o)},commitMount(e,t,n,r){var o;const i=null!=(o=e.__r3f)?o:{};e.raycast&&i.handlers&&i.eventCount&&Me(e).getState().internal.interaction.push(e)},getPublicInstance:e=>e,prepareForCommit:()=>null,preparePortalMount:e=>Se(e.getState().scene),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance(e){var t;const{attach:n,parent:r}=null!=(t=e.__r3f)?t:{};n&&r&&Oe(r,e,n),e.isObject3D&&(e.visible=!1),Fe(e)},unhideInstance(e,t){var n;const{attach:r,parent:o}=null!=(n=e.__r3f)?n:{};r&&o&&ke(o,e,r),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),Fe(e)},createTextInstance:s,hideTextInstance:s,unhideTextInstance:s,getCurrentEventPriority:()=>t?t():W.DefaultEventPriority,beforeActiveInstanceBlur:()=>{},afterActiveInstanceBlur:()=>{},detachDeletedInstance:()=>{},now:"undefined"!=typeof performance&&je.fun(performance.now)?performance.now:je.fun(Date.now)?Date.now:()=>0,scheduleTimeout:je.fun(setTimeout)?setTimeout:void 0,cancelTimeout:je.fun(clearTimeout)?clearTimeout:void 0}),applyProps:Ie}}(0,(function(){var e;const t="undefined"!=typeof self&&self||"undefined"!=typeof window&&window;if(!t)return W.DefaultEventPriority;switch(null==(e=t.event)?void 0:e.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return W.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return W.ContinuousEventPriority;default:return W.DefaultEventPriority}})),lt={objects:"shallow",strict:!1},ct=(e,t)=>{const n="function"==typeof e?e(t):e;return Be(n)?n:new b({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0,...e})};function ut(e){const n=rt.get(e),r=null==n?void 0:n.fiber,o=null==n?void 0:n.store,i="function"==typeof reportError?reportError:console.error,a=o||Ne(ot,it),m=r||at.createContainer(a,W.ConcurrentRoot,null,!1,null,"",i,null);let v;n||rt.set(e,{fiber:m,store:a});let h,g=!1;return{configure(t={}){let{gl:n,size:r,scene:o,events:i,onCreated:m,shadows:y=!1,linear:b=!1,flat:M=!1,legacy:j=!1,orthographic:S=!1,frameloop:_="always",dpr:P=[1,2],performance:k,raycaster:O,camera:R,onPointerMissed:A}=t,I=a.getState(),F=I.gl;I.gl||I.set({gl:F=ct(n,e)});let T=I.raycaster;T||I.set({raycaster:T=new s});const{params:z,...D}=O||{};if(je.equ(D,T,lt)||st(T,{...D}),je.equ(z,T.params,lt)||st(T,{params:{...T.params,...z}}),!I.camera||I.camera===h&&!je.equ(h,R,lt)){h=R;const e=R instanceof w,t=e?R:S?new l(0,0,0,0,.1,1e3):new c(75,0,.1,1e3);e||(t.position.z=5,R&&(st(t,R),("aspect"in R||"left"in R||"right"in R||"bottom"in R||"top"in R)&&(t.manual=!0,t.updateProjectionMatrix())),I.camera||null!=R&&R.rotation||t.lookAt(0,0,0)),I.set({camera:t}),T.camera=t}if(!I.scene){let e;o instanceof u?e=o:(e=new u,o&&st(e,o)),I.set({scene:Se(e)})}if(!I.xr){var L;const e=(e,t)=>{const n=a.getState();"never"!==n.frameloop&&it(e,!0,n,t)},t=()=>{const t=a.getState();t.gl.xr.enabled=t.gl.xr.isPresenting,t.gl.xr.setAnimationLoop(t.gl.xr.isPresenting?e:null),t.gl.xr.isPresenting||ot(t)},n={connect(){const e=a.getState().gl;e.xr.addEventListener("sessionstart",t),e.xr.addEventListener("sessionend",t)},disconnect(){const e=a.getState().gl;e.xr.removeEventListener("sessionstart",t),e.xr.removeEventListener("sessionend",t)}};"function"==typeof(null==(L=F.xr)?void 0:L.addEventListener)&&n.connect(),I.set({xr:n})}if(F.shadowMap){const e=F.shadowMap.enabled,t=F.shadowMap.type;if(F.shadowMap.enabled=!!y,je.boo(y))F.shadowMap.type=d;else if(je.str(y)){var B;const e={basic:E,percentage:x,soft:d,variance:C};F.shadowMap.type=null!=(B=e[y])?B:d}else je.obj(y)&&Object.assign(F.shadowMap,y);e===F.shadowMap.enabled&&t===F.shadowMap.type||(F.shadowMap.needsUpdate=!0)}const W=pe();if(W&&("enabled"in W?W.enabled=!j:"legacyMode"in W&&(W.legacyMode=j)),!g){st(F,{outputEncoding:b?3e3:3001,toneMapping:M?f:p})}I.legacy!==j&&I.set((()=>({legacy:j}))),I.linear!==b&&I.set((()=>({linear:b}))),I.flat!==M&&I.set((()=>({flat:M}))),!n||je.fun(n)||Be(n)||je.equ(n,F,lt)||st(F,n),i&&!I.events.handlers&&I.set({events:i(a)});const N=function(e,t){const n="undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement;if(t){const{width:e,height:r,top:o,left:i,updateStyle:a=n}=t;return{width:e,height:r,top:o,left:i,updateStyle:a}}if("undefined"!=typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement&&e.parentElement){const{width:t,height:r,top:o,left:i}=e.parentElement.getBoundingClientRect();return{width:t,height:r,top:o,left:i,updateStyle:n}}return"undefined"!=typeof OffscreenCanvas&&e instanceof OffscreenCanvas?{width:e.width,height:e.height,top:0,left:0,updateStyle:n}:{width:0,height:0,top:0,left:0}}(e,r);return je.equ(N,I.size,lt)||I.setSize(N.width,N.height,N.updateStyle,N.top,N.left),P&&I.viewport.dpr!==xe(P)&&I.setDpr(P),I.frameloop!==_&&I.setFrameloop(_),I.onPointerMissed||I.set({onPointerMissed:A}),k&&!je.equ(k,I.performance,lt)&&I.set((e=>({performance:{...e.performance,...k}}))),v=m,g=!0,this},render(n){return g||this.configure(),at.updateContainer(t.jsx(dt,{store:a,children:n,onCreated:v,rootElement:e}),m,null,(()=>{})),a},unmount(){ft(e)}}}function dt({store:e,children:n,onCreated:r,rootElement:o}){return ve((()=>{const t=e.getState();t.set((e=>({internal:{...e.internal,active:!0}}))),r&&r(t),e.getState().events.connected||null==t.events.connect||t.events.connect(o)}),[]),t.jsx(We.Provider,{value:e,children:n})}function ft(e,t){const n=rt.get(e),r=null==n?void 0:n.fiber;if(r){const o=null==n?void 0:n.store.getState();o&&(o.internal.active=!1),at.updateContainer(null,r,null,(()=>{o&&setTimeout((()=>{try{var n,r,i,a;null==o.events.disconnect||o.events.disconnect(),null==(n=o.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(i=o.gl)||null==i.forceContextLoss||i.forceContextLoss(),null!=(a=o.gl)&&a.xr&&o.xr.disconnect(),function(e){e.dispose&&"Scene"!==e.type&&e.dispose();for(const t in e)null==t.dispose||t.dispose(),delete e[t]}(o),rt.delete(e),t&&t(e)}catch(s){}}),500)}))}}at.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:e.version});const pt={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function mt(e){const{handlePointer:t}=Le(e);return{priority:1,enabled:!0,compute(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(pt).reduce(((e,n)=>({...e,[n]:t(n)})),{}),update:()=>{var t;const{events:n,internal:r}=e.getState();null!=(t=r.lastEvent)&&t.current&&n.handlers&&n.handlers.onPointerMove(r.lastEvent.current)},connect:t=>{var n;const{set:r,events:o}=e.getState();null==o.disconnect||o.disconnect(),r((e=>({events:{...e.events,connected:t}}))),Object.entries(null!=(n=o.handlers)?n:[]).forEach((([e,n])=>{const[r,o]=pt[e];t.addEventListener(r,n,{passive:o})}))},disconnect:()=>{const{set:t,events:n}=e.getState();var r;n.connected&&(Object.entries(null!=(r=n.handlers)?r:[]).forEach((([e,t])=>{if(n&&n.connected instanceof HTMLElement){const[r]=pt[e];n.connected.removeEventListener(r,t)}})),t((e=>({events:{...e.events,connected:void 0}}))))}}}const vt=e.forwardRef((function({children:n,fallback:r,resize:o,style:i,gl:a,events:s=mt,eventSource:l,eventPrefix:c,shadows:u,linear:d,flat:f,legacy:p,orthographic:m,frameloop:v,dpr:h,performance:g,raycaster:y,camera:b,scene:w,onPointerMissed:E,onCreated:x,...C},M){e.useMemo((()=>ce(j)),[]);const S=L(),[_,P]=z({scroll:!0,debounce:{scroll:50,resize:0},...o}),k=e.useRef(null),O=e.useRef(null);e.useImperativeHandle(M,(()=>k.current));const R=he(E),[A,I]=e.useState(!1),[F,T]=e.useState(!1);if(A)throw A;if(F)throw F;const D=e.useRef(null);ve((()=>{const r=k.current;P.width>0&&P.height>0&&r&&(D.current||(D.current=ut(r)),D.current.configure({gl:a,events:s,shadows:u,linear:d,flat:f,legacy:p,orthographic:m,frameloop:v,dpr:h,performance:g,raycaster:y,camera:b,scene:w,size:P,onPointerMissed:(...e)=>null==R.current?void 0:R.current(...e),onCreated:e=>{var t;null==e.events.connect||e.events.connect(l?(t=l)&&t.hasOwnProperty("current")?l.current:l:O.current),c&&e.setEvents({compute:(e,t)=>{const n=e[c+"X"],r=e[c+"Y"];t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),null==x||x(e)}}),D.current.render(t.jsx(S,{children:t.jsx(ye,{set:T,children:t.jsx(e.Suspense,{fallback:t.jsx(ge,{set:I}),children:n})})})))})),e.useEffect((()=>{const e=k.current;if(e)return()=>ft(e)}),[]);const B=l?"none":"auto";return t.jsx("div",{ref:O,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:B,...i},...C,children:t.jsx("div",{ref:_,style:{width:"100%",height:"100%"},children:t.jsx("canvas",{ref:k,style:{display:"block"},children:r})})})})),ht=e.forwardRef((function(e,n){return t.jsx(D,{children:t.jsx(vt,{...e,ref:n})})})),gt=e.createContext(null);function yt({map:t,children:n,onChange:r,domElement:o}){const i=t.map((e=>e.name+e.keys)).join("-"),a=e.useMemo((()=>N(q((()=>t.reduce(((e,t)=>({...e,[t.name]:!1})),{}))))),[i]),s=e.useMemo((()=>[a.subscribe,a.getState,a]),[i]),l=a.setState;return e.useEffect((()=>{const e=t.map((({name:e,keys:t,up:n})=>({keys:t,up:n,fn:t=>{l({[e]:t}),r&&r(e,t,s[1]())}}))).reduce(((e,{keys:t,fn:n,up:r=!0})=>(t.forEach((t=>e[t]={fn:n,pressed:!1,up:r})),e)),{}),n=({key:t,code:n})=>{const r=e[t]||e[n];if(!r)return;const{fn:o,pressed:i,up:a}=r;r.pressed=!0,!a&&i||o(!0)},i=({key:t,code:n})=>{const r=e[t]||e[n];if(!r)return;const{fn:o,up:i}=r;r.pressed=!1,i&&o(!1)},a=o||window;return a.addEventListener("keydown",n,{passive:!0}),a.addEventListener("keyup",i,{passive:!0}),()=>{a.removeEventListener("keydown",n),a.removeEventListener("keyup",i)}}),[o,i]),e.createElement(gt.Provider,{value:s,children:n})}function bt(t){const[n,r,o]=e.useContext(gt);return t?o(t):[n,r]}const wt=e.forwardRef((({sdfGlyphSize:t=64,anchorX:n="center",anchorY:r="middle",font:o,fontSize:i=1,children:a,characters:s,onSync:l,...c},u)=>{const d=Ke((({invalidate:e})=>e)),[f]=e.useState((()=>new H)),[p,m]=e.useMemo((()=>{const t=[];let n="";return e.Children.forEach(a,(e=>{"string"==typeof e||"number"==typeof e?n+=e:t.push(e)})),[t,n]}),[a]);return G((()=>new Promise((e=>V({font:o,characters:s},e)))),["troika-text",o,s]),e.useLayoutEffect((()=>{f.sync((()=>{d(),l&&l(f)}))})),e.useEffect((()=>()=>f.dispose()),[f]),e.createElement("primitive",U({object:f,ref:u,font:o,text:m,anchorX:n,anchorY:r,fontSize:i,sdfGlyphSize:t},c),p)})),Et=e=>e===Object(e)&&!Array.isArray(e)&&"function"!=typeof e;function xt(t,n){const r=Ke((e=>e.gl)),i=nt(S,Et(t)?Object.values(t):t);e.useLayoutEffect((()=>{null==n||n(i)}),[n]),e.useEffect((()=>{if("initTexture"in r){let e=[];Array.isArray(i)?e=i:i instanceof o?e=[i]:Et(i)&&(e=Object.values(i)),e.forEach((e=>{e instanceof o&&r.initTexture(e)}))}}),[r,i]);return e.useMemo((()=>{if(Et(t)){const e={};let n=0;for(const r in t)e[r]=i[n++];return e}return i}),[t,i])}xt.preload=e=>nt.preload(S,e),xt.clear=e=>nt.clear(S,e);const Ct=e.forwardRef((({domElement:t,selector:n,onChange:r,onLock:o,onUnlock:i,enabled:a=!0,makeDefault:s,...l},c)=>{const{camera:u,...d}=l,f=Ke((e=>e.setEvents)),p=Ke((e=>e.gl)),m=Ke((e=>e.camera)),v=Ke((e=>e.invalidate)),h=Ke((e=>e.events)),g=Ke((e=>e.get)),y=Ke((e=>e.set)),b=u||m,w=t||h.connected||p.domElement,E=e.useMemo((()=>new X(b)),[b]);return e.useEffect((()=>{if(a){E.connect(w);const e=g().events.compute;return f({compute(e,t){const n=t.size.width/2,r=t.size.height/2;t.pointer.set(n/t.size.width*2-1,-r/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)}}),()=>{E.disconnect(),f({compute:e})}}}),[a,E]),e.useEffect((()=>{const e=e=>{v(),r&&r(e)};E.addEventListener("change",e),o&&E.addEventListener("lock",o),i&&E.addEventListener("unlock",i);const t=()=>E.lock(),a=n?Array.from(document.querySelectorAll(n)):[document];return a.forEach((e=>e&&e.addEventListener("click",t))),()=>{E.removeEventListener("change",e),o&&E.removeEventListener("lock",o),i&&E.removeEventListener("unlock",i),a.forEach((e=>e?e.removeEventListener("click",t):void 0))}}),[r,o,i,n,E,v]),e.useEffect((()=>{if(s){const e=g().controls;return y({controls:E}),()=>y({controls:e})}}),[s,E]),e.createElement("primitive",U({ref:c,object:E},d))})),Mt=(e,t)=>{"updateRanges"in e?e.updateRanges[0]=t:e.updateRange=t};function jt(e,t,n=new g){const r=Math.PI*(e-.5),o=2*Math.PI*(t-.5);return n.x=Math.cos(o),n.y=Math.sin(r),n.z=Math.sin(o),n}const St=e.forwardRef((({inclination:t=.6,azimuth:n=.1,distance:r=1e3,mieCoefficient:o=.005,mieDirectionalG:i=.8,rayleigh:a=.5,turbidity:s=10,sunPosition:l=jt(t,n),...c},u)=>{const d=e.useMemo((()=>(new g).setScalar(r)),[r]),[f]=e.useState((()=>new Q));return e.createElement("primitive",U({object:f,ref:u,"material-uniforms-mieCoefficient-value":o,"material-uniforms-mieDirectionalG-value":i,"material-uniforms-rayleigh-value":a,"material-uniforms-sunPosition-value":l,"material-uniforms-turbidity-value":s,scale:d},c))}));let _t;const Pt=new Uint8Array(16);function kt(){if(!_t&&(_t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto),!_t))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return _t(Pt)}const Ot=[];for(let qn=0;qn<256;++qn)Ot.push((qn+256).toString(16).slice(1));const Rt={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)};function At(e,t,n){if(Rt.randomUUID&&!t&&!e)return Rt.randomUUID();const r=(e=e||{}).random||(e.rng||kt)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return function(e,t=0){return Ot[e[t+0]]+Ot[e[t+1]]+Ot[e[t+2]]+Ot[e[t+3]]+"-"+Ot[e[t+4]]+Ot[e[t+5]]+"-"+Ot[e[t+6]]+Ot[e[t+7]]+"-"+Ot[e[t+8]]+Ot[e[t+9]]+"-"+Ot[e[t+10]]+Ot[e[t+11]]+Ot[e[t+12]]+Ot[e[t+13]]+Ot[e[t+14]]+Ot[e[t+15]]}(r)}const It=new k,Ft=new g,Tt=new O,zt=new g,Dt=new O,Lt=new g,Bt=e.createContext(null),Wt=e.forwardRef((({children:t,material:n=P,texture:r="https://rawcdn.githack.com/pmndrs/drei-assets/9225a9f1fbd449d9411125c2f419b843d0308c9f/cloud.png",range:o,limit:i=200,frustumCulled:a,...s},l)=>{var c,u;const d=e.useMemo((()=>class extends n{constructor(){super();const e=parseInt(R.replace(/\D+/g,""))>=154?"opaque_fragment":"output_fragment";this.onBeforeCompile=t=>{t.vertexShader="attribute float opacity;\n               varying float vOpacity;\n              "+t.vertexShader.replace("#include <fog_vertex>","#include <fog_vertex>\n                 vOpacity = opacity;\n                "),t.fragmentShader="varying float vOpacity;\n              "+t.fragmentShader.replace(`#include <${e}>`,`#include <${e}>\n                 gl_FragColor = vec4(outgoingLight, diffuseColor.a * vOpacity);\n                `)}}}),[n]);ce({CloudMaterial:d});const f=e.useRef(null),p=e.useRef([]),m=e.useMemo((()=>new Float32Array(Array.from({length:i},(()=>1)))),[i]),v=e.useMemo((()=>new Float32Array(Array.from({length:i},(()=>[1,1,1])).flat())),[i]),h=xt(r);let y,b=0,w=0;const E=new O,x=new g(0,0,1),C=new g;Je(((e,t)=>{for(b=e.clock.getElapsedTime(),It.copy(f.current.matrixWorld).invert(),e.camera.matrixWorld.decompose(zt,Dt,Lt),w=0;w<p.current.length;w++)y=p.current[w],y.ref.current.matrixWorld.decompose(Ft,Tt,Lt),Ft.add(C.copy(y.position).applyQuaternion(Tt).multiply(Lt)),Tt.copy(Dt).multiply(E.setFromAxisAngle(x,y.rotation+=t*y.rotationFactor)),Lt.multiplyScalar(y.volume+(1+Math.sin(b*y.density*y.speed))/2*y.growth),y.matrix.compose(Ft,Tt,Lt).premultiply(It),y.dist=Ft.distanceTo(zt);for(p.current.sort(((e,t)=>t.dist-e.dist)),w=0;w<p.current.length;w++)y=p.current[w],m[w]=y.opacity*(y.dist<y.fade-1?y.dist/y.fade:1),f.current.setMatrixAt(w,y.matrix),f.current.setColorAt(w,y.color);f.current.geometry.attributes.opacity.needsUpdate=!0,f.current.instanceMatrix.needsUpdate=!0,f.current.instanceColor&&(f.current.instanceColor.needsUpdate=!0)})),e.useLayoutEffect((()=>{const e=Math.min(i,void 0!==o?o:i,p.current.length);f.current.count=e,Mt(f.current.instanceMatrix,{offset:0,count:16*e}),f.current.instanceColor&&Mt(f.current.instanceColor,{offset:0,count:3*e}),Mt(f.current.geometry.attributes.opacity,{offset:0,count:e})}));let M=[null!==(c=h.image.width)&&void 0!==c?c:1,null!==(u=h.image.height)&&void 0!==u?u:1],j=Math.max(M[0],M[1]);return M=[M[0]/j,M[1]/j],e.createElement("group",U({ref:l},s),e.createElement(Bt.Provider,{value:p},t,e.createElement("instancedMesh",{matrixAutoUpdate:!1,ref:f,args:[null,null,i],frustumCulled:a},e.createElement("instancedBufferAttribute",{usage:_,attach:"instanceColor",args:[v,3]}),e.createElement("planeGeometry",{args:[...M]},e.createElement("instancedBufferAttribute",{usage:_,attach:"attributes-opacity",args:[m,1]})),e.createElement("cloudMaterial",{key:n.name,map:h,transparent:!0,depthWrite:!1}))))})),Nt=e.forwardRef((({opacity:t=1,speed:n=0,bounds:r=[5,1,1],segments:o=20,color:i="#ffffff",fade:a=10,volume:s=6,smallestVolume:l=.25,distribute:c=null,growth:u=4,concentrate:d="inside",seed:f=Math.random(),...p},m)=>{function v(){const e=1e4*Math.sin(f++);return e-Math.floor(e)}const y=e.useContext(Bt),b=e.useRef(null),[w]=e.useState((()=>At())),E=e.useMemo((()=>[...new Array(o)].map(((e,t)=>({segments:o,bounds:new g(1,1,1),position:new g,uuid:w,index:t,ref:b,dist:0,matrix:new k,color:new h,rotation:t*(Math.PI/o)})))),[o,w]);return e.useLayoutEffect((()=>{E.forEach(((e,f)=>{var p;st(e,{volume:s,color:i,speed:n,growth:u,opacity:t,fade:a,bounds:r,density:Math.max(.5,v()),rotationFactor:Math.max(.2,.5*v())*n});const m=null==c?void 0:c(e,f);(m||o>1)&&e.position.copy(e.bounds).multiply(null!==(p=null==m?void 0:m.point)&&void 0!==p?p:{x:2*v()-1,y:2*v()-1,z:2*v()-1});const h=Math.abs(e.position.x),g=Math.abs(e.position.y),y=Math.abs(e.position.z),b=Math.max(h,g,y);e.length=1,h===b&&(e.length-=h/e.bounds.x),g===b&&(e.length-=g/e.bounds.y),y===b&&(e.length-=y/e.bounds.z),e.volume=(void 0!==(null==m?void 0:m.volume)?m.volume:Math.max(Math.max(0,l),"random"===d?v():"inside"===d?e.length:1-e.length))*s}))}),[d,r,a,i,t,u,s,f,o,n]),e.useLayoutEffect((()=>{const e=E;return y.current=[...y.current,...e],()=>{y.current=y.current.filter((e=>e.uuid!==w))}}),[E]),e.useImperativeHandle(m,(()=>b.current),[]),e.createElement("group",U({ref:b},p))})),qt=e.forwardRef(((t,n)=>e.useContext(Bt)?e.createElement(Nt,U({ref:n},t)):e.createElement(Wt,null,e.createElement(Nt,U({ref:n},t)))));function Ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ht(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ht(Object(n),!0).forEach((function(t){Ut(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ht(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}const Gt=new O;new F;const $t=new g;new I;const Yt=new k,Xt=new g,Qt=new O,Zt=new g,Kt=({x:e,y:t,z:n,w:r})=>Gt.set(e,t,n,r),Jt={fixed:1,dynamic:0,kinematicPosition:2,kinematicVelocity:3},en=e=>Jt[e],tn=e=>e?e instanceof O?[e.x,e.y,e.z,e.w]:e instanceof g||e instanceof F?[e.x,e.y,e.z]:Array.isArray(e)?e:[e]:[0];function nn(t){const n=e.useRef();return void 0===n.current&&(n.current={value:"function"==typeof t?t():t}),n.current.value}const rn=({onStep:e,updatePriority:t})=>(Je(((t,n)=>{e(n)}),t),null),on=({onStep:t})=>((t=>{const n=e.useRef(t),r=e.useRef(0),o=e.useRef(0);e.useEffect((()=>{n.current=t}),[t]),e.useEffect((()=>{const e=()=>{const t=performance.now(),i=t-o.current;r.current=requestAnimationFrame(e),n.current(i/1e3),o.current=t};return r.current=requestAnimationFrame(e),()=>cancelAnimationFrame(r.current)}),[])})((e=>{t(e)})),null),an=({onStep:e,type:t,updatePriority:r})=>"independent"===t?n.createElement(on,{onStep:e}):n.createElement(rn,{onStep:e,updatePriority:r});var sn=e.memo(an);function ln(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}const cn=["mass","linearDamping","angularDamping","type","onCollisionEnter","onCollisionExit","onIntersectionEnter","onIntersectionExit","onContactForce","children","canSleep","ccd","gravityScale"],un=(e,t,n)=>{const r=t.slice();if("heightfield"===e){const e=r[3];return e.x*=n.x,e.x*=n.y,e.x*=n.z,r}if("trimesh"===e||"convexHull"===e)return r[0]=((e,t)=>{const n=Array.from(e);for(let r=0;r<e.length/3;r++)n[3*r]*=t.x,n[3*r+1]*=t.y,n[3*r+2]*=t.z;return n})(r[0],n),r;const o=[n.x,n.y,n.z,n.x,n.x];return r.map(((e,t)=>o[t]*e))},dn=["shape","args"],fn="Please pick ONLY ONE of the `density`, `mass` and `massProperties` options.",pn={sensor:(e,t)=>{e.setSensor(t)},collisionGroups:(e,t)=>{e.setCollisionGroups(t)},solverGroups:(e,t)=>{e.setSolverGroups(t)},friction:(e,t)=>{e.setFriction(t)},frictionCombineRule:(e,t)=>{e.setFrictionCombineRule(t)},restitution:(e,t)=>{e.setRestitution(t)},restitutionCombineRule:(e,t)=>{e.setRestitutionCombineRule(t)},quaternion:()=>{},position:()=>{},rotation:()=>{},scale:()=>{}},mn=Object.keys(pn),vn=(e,t,n)=>{const r=n.get(e.handle);if(r){var o;const n=r.object.parent.getWorldScale($t),i=null===(o=r.worldParent)||void 0===o?void 0:o.matrixWorld.clone().invert();r.object.updateWorldMatrix(!0,!1),Yt.copy(r.object.matrixWorld),i&&Yt.premultiply(i),Yt.decompose(Xt,Qt,Zt),e.parent()?(e.setTranslationWrtParent({x:Xt.x*n.x,y:Xt.y*n.y,z:Xt.z*n.z}),e.setRotationWrtParent(Qt)):(e.setTranslation({x:Xt.x*n.x,y:Xt.y*n.y,z:Xt.z*n.z}),e.setRotation(Qt)),mn.forEach((n=>{if(n in t){const r=t[n];pn[n](e,r,t)}})),((e,t)=>{if(void 0===t.density)if(void 0===t.mass)void 0!==t.massProperties&&e.setMassProperties(t.massProperties.mass,t.massProperties.centerOfMass,t.massProperties.principalAngularInertia,t.massProperties.angularInertiaLocalFrame);else{if(void 0!==t.massProperties)throw new Error(fn);e.setMass(t.mass)}else{if(void 0!==t.mass||void 0!==t.massProperties)throw new Error(fn);e.setDensity(t.density)}})(e,t)}},hn={cuboid:"cuboid",ball:"ball",hull:"convexHull",trimesh:"trimesh"},gn=(e,t)=>{switch(t){case"cuboid":{e.computeBoundingBox();const{boundingBox:t}=e,n=t.getSize(new g);return{args:[n.x/2,n.y/2,n.z/2],offset:t.getCenter(new g)}}case"ball":{e.computeBoundingSphere();const{boundingSphere:t}=e;return{args:[t.radius],offset:t.center}}case"trimesh":{var n;const t=e.index?e.clone():function(e,t=1e-4){t=Math.max(t,Number.EPSILON);const n={},r=e.getIndex(),o=e.getAttribute("position"),i=r?r.count:o.count;let a=0;const s=Object.keys(e.attributes),l={},c={},u=[],d=["getX","getY","getZ","getW"];for(let v=0,h=s.length;v<h;v++){const t=s[v];l[t]=[];const n=e.morphAttributes[t];n&&(c[t]=new Array(n.length).fill(0).map((()=>[])))}const f=Math.log10(1/t),p=Math.pow(10,f);for(let v=0;v<i;v++){const t=r?r.getX(v):v;let o="";for(let n=0,r=s.length;n<r;n++){const r=s[n],i=e.getAttribute(r),a=i.itemSize;for(let e=0;e<a;e++)o+=~~(i[d[e]](t)*p)+","}if(o in n)u.push(n[o]);else{for(let n=0,r=s.length;n<r;n++){const r=s[n],o=e.getAttribute(r),i=e.morphAttributes[r],a=o.itemSize,u=l[r],f=c[r];for(let e=0;e<a;e++){const n=d[e];if(u.push(o[n](t)),i)for(let e=0,r=i.length;e<r;e++)f[e].push(i[e][n](t))}}n[o]=a,u.push(a),a++}}const m=e.clone();for(let v=0,h=s.length;v<h;v++){const t=s[v],n=e.getAttribute(t),r=new n.array.constructor(l[t]),o=new A(r,n.itemSize,n.normalized);if(m.setAttribute(t,o),t in c)for(let i=0;i<c[t].length;i++){const n=e.morphAttributes[t][i],r=new n.array.constructor(c[t][i]),o=new A(r,n.itemSize,n.normalized);m.morphAttributes[t][i]=o}}return m.setIndex(u),m}(e);return{args:[t.attributes.position.array,null===(n=t.index)||void 0===n?void 0:n.array],offset:new g}}case"hull":return{args:[e.clone().attributes.position.array],offset:new g}}return{args:[],offset:new g}},yn=e=>({collision:!!(null!=e&&e.onCollisionEnter||null!=e&&e.onCollisionExit||null!=e&&e.onIntersectionEnter||null!=e&&e.onIntersectionExit),contactForce:!(null==e||!e.onContactForce)}),bn=(e={})=>ln(e,cn),wn=()=>{const t=e.useContext(Cn);if(!t)throw new Error("react-three-rapier: useRapier must be used within <Physics />!");return t},En=(t,n,r=!0)=>{const[o,i]=e.useState([]);return e.useEffect((()=>{t.current&&!1!==n.colliders&&i((({object:e,ignoreMeshColliders:t=!0,options:n})=>{const r=[];e.updateWorldMatrix(!0,!1);const o=e.matrixWorld.clone().invert(),i=e=>{if("isMesh"in e){if(t&&(e=>{let t=!1;return e.traverseAncestors((e=>{"MeshCollider"===e.userData.r3RapierType&&(t=!0)})),t})(e))return;const i=e.getWorldScale(Zt),a=hn[n.colliders||"cuboid"];e.updateWorldMatrix(!0,!1),Yt.copy(e.matrixWorld).premultiply(o).decompose(Xt,Qt,Zt);const s=(new F).setFromQuaternion(Qt,"XYZ"),{geometry:l}=e,{args:c,offset:u}=gn(l,n.colliders||"cuboid"),d=Vt(Vt({},bn(n)),{},{args:c,shape:a,rotation:[s.x,s.y,s.z],position:[Xt.x+u.x*i.x,Xt.y+u.y*i.y,Xt.z+u.z*i.z],scale:[i.x,i.y,i.z]});r.push(d)}};return n.includeInvisible?e.traverse(i):e.traverseVisible(i),r})({object:t.current,options:n,ignoreMeshColliders:r}))}),[n.colliders]),o},xn=e.memo((()=>{const{world:t}=wn(),r=e.useRef(null);return Je((()=>{const e=r.current;if(!e)return;const n=t.debugRender();e.geometry.setAttribute("position",new A(n.vertices,3)),e.geometry.setAttribute("color",new A(n.colors,4))})),n.createElement("group",null,n.createElement("lineSegments",{ref:r,frustumCulled:!1},n.createElement("lineBasicMaterial",{color:16777215,vertexColors:!0}),n.createElement("bufferGeometry",null)))})),Cn=e.createContext(void 0),Mn=(e,t)=>{var n,r,o,i,a,s;return{target:{rigidBody:e.rigidBody.object,collider:e.collider.object,colliderObject:null===(n=e.collider.state)||void 0===n?void 0:n.object,rigidBodyObject:null===(r=e.rigidBody.state)||void 0===r?void 0:r.object},other:{rigidBody:t.rigidBody.object,collider:t.collider.object,colliderObject:null===(o=t.collider.state)||void 0===o?void 0:o.object,rigidBodyObject:null===(i=t.rigidBody.state)||void 0===i?void 0:i.object},rigidBody:t.rigidBody.object,collider:t.collider.object,colliderObject:null===(a=t.collider.state)||void 0===a?void 0:a.object,rigidBodyObject:null===(s=t.rigidBody.state)||void 0===s?void 0:s.object}},jn=async()=>{let e=await oe((()=>import("./glm-@dimforge-C9UPVe2M.js")),__vite__mapDeps([]));return await e.init(),e},Sn=t=>{const{colliders:r="cuboid",children:o,timeStep:i=1/60,paused:a=!1,interpolate:s=!0,updatePriority:l,updateLoop:c="follow",debug:u=!1,gravity:d=[0,-9.81,0],allowedLinearError:f=.001,predictionDistance:p=.002,numSolverIterations:m=4,numAdditionalFrictionIterations:v=4,numInternalPgsIterations:h=1,minIslandSize:y=128,maxCcdSubsteps:b=1,erp:w=.8}=t,E=ne(jn),{invalidate:x}=Ke(),C=nn((()=>new Map)),M=nn((()=>new Map)),j=nn((()=>new Map)),S=nn((()=>new Map)),_=nn((()=>new ee(!1))),P=nn((()=>new Set)),k=nn((()=>new Set)),{proxy:O,reset:R,set:A}=nn((()=>(e=>{let t;return{proxy:new Proxy({},{get:(n,r)=>(t||(t=e()),Reflect.get(t,r)),set:(n,r,o)=>(t||(t=e()),Reflect.set(t,r,o))}),reset:()=>{t=void 0},set:e=>{t=e}}})((()=>new E.World((e=>{const[t,n,r]=e;return new g(t,n,r)})(d))))));e.useEffect((()=>()=>{O.free(),R()}),[]),e.useEffect((()=>{O.gravity=(e=>{if(Array.isArray(e))return new Z(e[0],e[1],e[2]);if("number"==typeof e)return new Z(e,e,e);{const t=e;return new Z(t.x,t.y,t.z)}})(d),O.integrationParameters.numSolverIterations=m,O.integrationParameters.numAdditionalFrictionIterations=v,O.integrationParameters.numInternalPgsIterations=h,O.integrationParameters.allowedLinearError=f,O.integrationParameters.minIslandSize=y,O.integrationParameters.maxCcdSubsteps=b,O.integrationParameters.predictionDistance=p,O.integrationParameters.erp=w}),[O,...d,m,v,h,f,y,b,p,w]);const I=e.useCallback((e=>{var t;const n=O.getCollider(e),r=S.get(e),o=M.get(e),i=null==n||null===(t=n.parent())||void 0===t?void 0:t.handle,a=void 0!==i?O.getRigidBody(i):void 0;return{collider:{object:n,events:r,state:o},rigidBody:{object:a,events:a&&void 0!==i?j.get(i):void 0,state:void 0!==i?C.get(i):void 0}}}),[]),[F]=e.useState({previousState:{},accumulator:0}),z=e.useCallback((e=>{const t=O,n="vary"===i,r=T.clamp(e,0,.5),o=e=>{P.forEach((e=>{e.current(t)})),t.timestep=e,t.step(_),k.forEach((e=>{e.current(t)}))};if(n)o(r);else for(F.accumulator+=r;F.accumulator>=i;)s&&(F.previousState={},t.forEachRigidBody((e=>{F.previousState[e.handle]={position:e.translation(),rotation:e.rotation()}}))),o(i),F.accumulator-=i;const l=n||!s||a?1:F.accumulator/i;C.forEach(((e,n)=>{const r=t.getRigidBody(n),o=j.get(n);if(null!=o&&o.onSleep||null!=o&&o.onWake){var i,a;if(r.isSleeping()&&!e.isSleeping)null==o||null===(i=o.onSleep)||void 0===i||i.call(o);if(!r.isSleeping()&&e.isSleeping)null==o||null===(a=o.onWake)||void 0===a||a.call(o);e.isSleeping=r.isSleeping()}if(!r||r.isSleeping()&&!("isInstancedMesh"in e.object)||!e.setMatrix)return;let s=r.translation(),c=r.rotation(),u=F.previousState[n];u&&(Yt.compose(u.position,Kt(u.rotation),e.scale).premultiply(e.invertedWorldMatrix).decompose(Xt,Qt,Zt),"mesh"==e.meshType&&(e.object.position.copy(Xt),e.object.quaternion.copy(Qt))),Yt.compose(s,Kt(c),e.scale).premultiply(e.invertedWorldMatrix).decompose(Xt,Qt,Zt),"instancedMesh"==e.meshType?e.setMatrix(Yt):(e.object.position.lerp(Xt,l),e.object.quaternion.slerp(Qt,l))})),_.drainCollisionEvents(((e,n,r)=>{const o=I(e),i=I(n);if(null==o||!o.collider.object||null==i||!i.collider.object)return;const a=Mn(o,i),s=Mn(i,o);var l,c,u,d,f,p,m,v,h,g,y,b,w,E,x,C,M,j,S,_,P,k,O,R;r?t.contactPair(o.collider.object,i.collider.object,((e,t)=>{var n,r,l,c,u,d,f,p;null===(n=o.rigidBody.events)||void 0===n||null===(r=n.onCollisionEnter)||void 0===r||r.call(n,Vt(Vt({},a),{},{manifold:e,flipped:t})),null===(l=i.rigidBody.events)||void 0===l||null===(c=l.onCollisionEnter)||void 0===c||c.call(l,Vt(Vt({},s),{},{manifold:e,flipped:t})),null===(u=o.collider.events)||void 0===u||null===(d=u.onCollisionEnter)||void 0===d||d.call(u,Vt(Vt({},a),{},{manifold:e,flipped:t})),null===(f=i.collider.events)||void 0===f||null===(p=f.onCollisionEnter)||void 0===p||p.call(f,Vt(Vt({},s),{},{manifold:e,flipped:t}))})):(null===(l=o.rigidBody.events)||void 0===l||null===(c=l.onCollisionExit)||void 0===c||c.call(l,a),null===(u=i.rigidBody.events)||void 0===u||null===(d=u.onCollisionExit)||void 0===d||d.call(u,s),null===(f=o.collider.events)||void 0===f||null===(p=f.onCollisionExit)||void 0===p||p.call(f,a),null===(m=i.collider.events)||void 0===m||null===(v=m.onCollisionExit)||void 0===v||v.call(m,s));r?t.intersectionPair(o.collider.object,i.collider.object)&&(null===(h=o.rigidBody.events)||void 0===h||null===(g=h.onIntersectionEnter)||void 0===g||g.call(h,a),null===(y=i.rigidBody.events)||void 0===y||null===(b=y.onIntersectionEnter)||void 0===b||b.call(y,s),null===(w=o.collider.events)||void 0===w||null===(E=w.onIntersectionEnter)||void 0===E||E.call(w,a),null===(x=i.collider.events)||void 0===x||null===(C=x.onIntersectionEnter)||void 0===C||C.call(x,s)):(null===(M=o.rigidBody.events)||void 0===M||null===(j=M.onIntersectionExit)||void 0===j||j.call(M,a),null===(S=i.rigidBody.events)||void 0===S||null===(_=S.onIntersectionExit)||void 0===_||_.call(S,s),null===(P=o.collider.events)||void 0===P||null===(k=P.onIntersectionExit)||void 0===k||k.call(P,a),null===(O=i.collider.events)||void 0===O||null===(R=O.onIntersectionExit)||void 0===R||R.call(O,s))})),_.drainContactForceEvents((e=>{var t,n,r,o,i,a,s,l;const c=I(e.collider1()),u=I(e.collider2());if(null==c||!c.collider.object||null==u||!u.collider.object)return;const d=Mn(c,u),f=Mn(u,c);null===(t=c.rigidBody.events)||void 0===t||null===(n=t.onContactForce)||void 0===n||n.call(t,Vt(Vt({},d),{},{totalForce:e.totalForce(),totalForceMagnitude:e.totalForceMagnitude(),maxForceDirection:e.maxForceDirection(),maxForceMagnitude:e.maxForceMagnitude()})),null===(r=u.rigidBody.events)||void 0===r||null===(o=r.onContactForce)||void 0===o||o.call(r,Vt(Vt({},f),{},{totalForce:e.totalForce(),totalForceMagnitude:e.totalForceMagnitude(),maxForceDirection:e.maxForceDirection(),maxForceMagnitude:e.maxForceMagnitude()})),null===(i=c.collider.events)||void 0===i||null===(a=i.onContactForce)||void 0===a||a.call(i,Vt(Vt({},d),{},{totalForce:e.totalForce(),totalForceMagnitude:e.totalForceMagnitude(),maxForceDirection:e.maxForceDirection(),maxForceMagnitude:e.maxForceMagnitude()})),null===(s=u.collider.events)||void 0===s||null===(l=s.onContactForce)||void 0===l||l.call(s,Vt(Vt({},f),{},{totalForce:e.totalForce(),totalForceMagnitude:e.totalForceMagnitude(),maxForceDirection:e.maxForceDirection(),maxForceMagnitude:e.maxForceMagnitude()}))})),t.forEachActiveRigidBody((()=>{x()}))}),[a,i,s,O]),D=e.useMemo((()=>({rapier:E,world:O,setWorld:e=>{A(e)},physicsOptions:{colliders:r,gravity:d},rigidBodyStates:C,colliderStates:M,rigidBodyEvents:j,colliderEvents:S,beforeStepCallbacks:P,afterStepCallbacks:k,isPaused:a,isDebug:u,step:z})),[a,z,u,r,d]),L=e.useCallback((e=>{a||z(e)}),[a,z]);return n.createElement(Cn.Provider,{value:D},n.createElement(sn,{onStep:L,type:c,updatePriority:l}),u&&n.createElement(xn,null),o)};function _n(){return _n=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},_n.apply(this,arguments)}const Pn=(t,n,r)=>{const o=e.useRef(),i=e.useCallback((()=>(o.current||(o.current=t()),o.current)),r);return e.useEffect((()=>{const e=i();return()=>{n(e),o.current=void 0}}),[i]),i},kn=(t,n=null)=>{const r=e.useRef(n);return t&&"function"!=typeof t?(t.current||(t.current=r.current),t):r},On=e.memo(e.forwardRef(((t,r)=>{const{children:o,position:i,rotation:a,quaternion:s,scale:l,name:c}=t,{world:u,colliderEvents:d,colliderStates:f}=wn(),p=Bn(),m=kn(r),v=e.useRef(null),h=dn.flatMap((e=>Array.isArray(t[e])?[...t[e]]:t[e])),y=Pn((()=>{const e=v.current.getWorldScale((({x:e,y:t,z:n}={x:0,y:0,z:0})=>new g(e,t,n))()),n=((e,t,n,r)=>{const o=un(e.shape,e.args,n),i=K[e.shape](...o);return t.createCollider(i,null==r?void 0:r())})(t,u,e,null==p?void 0:p.getRigidBody);return"function"==typeof r&&r(n),m.current=n,n}),(e=>{u.getCollider(e.handle)&&u.removeCollider(e,!0)}),[...h,p]);e.useEffect((()=>{const e=y();return f.set(e.handle,((e,t,n)=>({collider:e,worldParent:n||void 0,object:t}))(e,v.current,null==p?void 0:p.ref.current)),()=>{f.delete(e.handle)}}),[y]);const b=e.useMemo((()=>Vt(Vt({},bn(null==p?void 0:p.options)),t)),[t,null==p?void 0:p.options]);return((t,n,r)=>{const o=e.useMemo((()=>mn.flatMap((e=>tn(n[e])))),[n]);e.useEffect((()=>{const e=t();vn(e,n,r)}),[...o,t])})(y,b,f),((t,n,r,o={})=>{const{onCollisionEnter:i,onCollisionExit:a,onIntersectionEnter:s,onIntersectionExit:l,onContactForce:c}=n;e.useEffect((()=>{const e=t();if(e){const{collision:t,contactForce:u}=yn(n),d=t||o.collision,f=u||o.contactForce;d&&f?e.setActiveEvents(J.COLLISION_EVENTS|J.CONTACT_FORCE_EVENTS):d?e.setActiveEvents(J.COLLISION_EVENTS):f&&e.setActiveEvents(J.CONTACT_FORCE_EVENTS),r.set(e.handle,{onCollisionEnter:i,onCollisionExit:a,onIntersectionEnter:s,onIntersectionExit:l,onContactForce:c})}return()=>{e&&r.delete(e.handle)}}),[i,a,s,l,c,o])})(y,b,d,yn(null==p?void 0:p.options)),n.createElement("object3D",{position:i,rotation:a,quaternion:s,scale:l,ref:v,name:c},o)})));n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"cuboid",ref:t})))).displayName="CuboidCollider";n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"roundCuboid",ref:t})))).displayName="RoundCuboidCollider";n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"ball",ref:t})))).displayName="BallCollider";const Rn=n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"capsule",ref:t}))));Rn.displayName="CapsuleCollider";n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"heightfield",ref:t})))).displayName="HeightfieldCollider";n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"trimesh",ref:t})))).displayName="TrimeshCollider";n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"cone",ref:t})))).displayName="ConeCollider";n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"roundCone",ref:t})))).displayName="RoundConeCollider";const An=n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"cylinder",ref:t}))));An.displayName="CylinderCollider",An.displayName="RoundCylinderCollider";n.forwardRef(((e,t)=>n.createElement(On,_n({},e,{shape:"convexHull",ref:t})))).displayName="ConvexHullCollider";const In=["args","colliders","canSleep"],Fn={gravityScale:(e,t)=>{e.setGravityScale(t,!0)},additionalSolverIterations(e,t){e.setAdditionalSolverIterations(t)},linearDamping:(e,t)=>{e.setLinearDamping(t)},angularDamping:(e,t)=>{e.setAngularDamping(t)},dominanceGroup:(e,t)=>{e.setDominanceGroup(t)},enabledRotations:(e,[t,n,r])=>{e.setEnabledRotations(t,n,r,!0)},enabledTranslations:(e,[t,n,r])=>{e.setEnabledTranslations(t,n,r,!0)},lockRotations:(e,t)=>{e.lockRotations(t,!0)},lockTranslations:(e,t)=>{e.lockTranslations(t,!0)},angularVelocity:(e,[t,n,r])=>{e.setAngvel({x:t,y:n,z:r},!0)},linearVelocity:(e,[t,n,r])=>{e.setLinvel({x:t,y:n,z:r},!0)},ccd:(e,t)=>{e.enableCcd(t)},userData:(e,t)=>{e.userData=t},type(e,t){e.setBodyType(en(t),!0)},position:()=>{},rotation:()=>{},quaternion:()=>{},scale:()=>{}},Tn=Object.keys(Fn),zn=(t,n,r,o=!0)=>{const i=e.useMemo((()=>Tn.flatMap((e=>tn(n[e])))),[n]);e.useEffect((()=>{((e,t,n,r=!0)=>{if(!e)return;const o=n.get(e.handle);o&&(r&&(o.object.updateWorldMatrix(!0,!1),Yt.copy(o.object.matrixWorld).decompose(Xt,Qt,Zt),e.setTranslation(Xt,!1),e.setRotation(Qt,!1)),Tn.forEach((n=>{n in t&&Fn[n](e,t[n])})))})(t(),n,r,o)}),i)},Dn=["children","type","position","rotation","scale","quaternion","transformState"],Ln=e.createContext(void 0),Bn=()=>e.useContext(Ln),Wn=e.memo(e.forwardRef(((t,r)=>{const{children:o,type:i,position:a,rotation:s,scale:l,quaternion:c,transformState:u}=t,d=ln(t,Dn),f=e.useRef(null),p=kn(r),{world:m,rigidBodyStates:v,physicsOptions:h,rigidBodyEvents:g}=wn(),y=e.useMemo((()=>Vt(Vt(Vt({},h),t),{},{children:void 0})),[h,t]),b=In.flatMap((e=>Array.isArray(y[e])?[...y[e]]:y[e])),w=En(f,y),E=Pn((()=>{const e=(e=>{var t;const n=en((null==e?void 0:e.type)||"dynamic"),r=new te(n);return r.canSleep=null===(t=null==e?void 0:e.canSleep)||void 0===t||t,r})(y),t=m.createRigidBody(e);return"function"==typeof r&&r(t),p.current=t,t}),(e=>{m.getRigidBody(e.handle)&&m.removeRigidBody(e)}),b);e.useEffect((()=>{const e=E(),n=(({rigidBody:e,object:t,setMatrix:n,getMatrix:r,worldScale:o,meshType:i="mesh"})=>{t.updateWorldMatrix(!0,!1);const a=t.parent.matrixWorld.clone().invert();return{object:t,rigidBody:e,invertedWorldMatrix:a,setMatrix:n||(e=>{t.matrix.copy(e)}),getMatrix:r||(e=>e.copy(t.matrix)),scale:o||t.getWorldScale(Zt).clone(),isSleeping:!1,meshType:i}})({rigidBody:e,object:f.current});return v.set(e.handle,t.transformState?t.transformState(n):n),()=>{v.delete(e.handle)}}),[E]),zn(E,y,v),((t,n,r)=>{const{onWake:o,onSleep:i,onCollisionEnter:a,onCollisionExit:s,onIntersectionEnter:l,onIntersectionExit:c,onContactForce:u}=n,d={onWake:o,onSleep:i,onCollisionEnter:a,onCollisionExit:s,onIntersectionEnter:l,onIntersectionExit:c,onContactForce:u};e.useEffect((()=>{const e=t();return r.set(e.handle,d),()=>{r.delete(e.handle)}}),[o,i,a,s,l,c,u])})(E,y,g);const x=e.useMemo((()=>({ref:f,getRigidBody:E,options:y})),[E]);return n.createElement(Ln.Provider,{value:x},n.createElement("object3D",_n({ref:f},d,{position:a,rotation:s,quaternion:c,scale:l}),o,w.map(((e,t)=>n.createElement(On,_n({key:t},e))))))})));Wn.displayName="RigidBody";e.memo((t=>{const{children:r,type:o}=t,{physicsOptions:i}=wn(),a=e.useRef(null),{options:s}=Bn(),l=e.useMemo((()=>Vt(Vt(Vt({},i),s),{},{children:void 0,colliders:o})),[i,s]),c=En(a,l,!1);return n.createElement("object3D",{ref:a,userData:{r3RapierType:"MeshCollider"}},r,c.map(((e,t)=>n.createElement(On,_n({key:t},e)))))})).displayName="MeshCollider";const Nn=["children","instances","colliderNodes","position","rotation","quaternion","scale"];e.memo(e.forwardRef(((t,r)=>{const o=kn(r,[]),i=e.useRef(null),a=e.useRef(null),{children:s,instances:l,colliderNodes:c=[],position:u,rotation:d,quaternion:f,scale:p}=t,m=ln(t,Nn),v=En(i,Vt(Vt({},t),{},{children:void 0})),h=()=>{const e=a.current.children[0];if(e&&"isInstancedMesh"in e)return e};e.useEffect((()=>{const e=h();e&&e.instanceMatrix.setUsage(_)}),[]);return n.createElement("object3D",_n({ref:i},m,{position:u,rotation:d,quaternion:f,scale:p}),n.createElement("object3D",{ref:a},s),null==l?void 0:l.map(((t,r)=>n.createElement(Wn,_n({},m,t,{ref:e=>o.current[r]=e,transformState:e=>((e,t)=>{const n=h();return n?Vt(Vt({},e),{},{getMatrix:e=>(n.getMatrixAt(t,e),e),setMatrix:e=>{n.setMatrixAt(t,e),n.instanceMatrix.needsUpdate=!0},meshType:"instancedMesh"}):e})(e,r)}),n.createElement(n.Fragment,null,c.map(((t,r)=>n.createElement(e.Fragment,{key:r},t))),v.map(((e,t)=>n.createElement(On,_n({key:t},e)))))))))}))).displayName="InstancedRigidBodies";export{Rn as C,yt as K,Sn as P,Wn as R,St as S,wt as T,oe as _,Je as a,xt as b,ht as c,Ct as d,Ke as e,bt as f,qt as g,wn as u};
