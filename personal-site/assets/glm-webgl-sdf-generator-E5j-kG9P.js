function e(){var e=function(e){function t(e,t,n,r,a,i,o,c,l,u){var v=1-l;u.x=v*v*v*e+3*v*v*l*n+3*v*l*l*a+l*l*l*o,u.y=v*v*v*t+3*v*v*l*r+3*v*l*l*i+l*l*l*c}function n(e,t){for(var n,r,a,i,o,c=/([MLQCZ])([^MLQCZ]*)/g;n=c.exec(e);){var l=n[2].replace(/^\s*|\s*$/g,"").split(/[,\s]+/).map((function(e){return parseFloat(e)}));switch(n[1]){case"M":i=r=l[0],o=a=l[1];break;case"L":l[0]===i&&l[1]===o||t("L",i,o,i=l[0],o=l[1]);break;case"Q":t("Q",i,o,i=l[2],o=l[3],l[0],l[1]);break;case"C":t("C",i,o,i=l[4],o=l[5],l[0],l[1],l[2],l[3]);break;case"Z":i===r&&o===a||t("L",i,o,r,a)}}}function r(e,r,a){void 0===a&&(a=16);var i={x:0,y:0};n(e,(function(e,n,o,c,l,u,v,s,f){switch(e){case"L":r(n,o,c,l);break;case"Q":for(var g=n,d=o,m=1;m<a;m++)E=o,y=v,b=l,_=void 0,_=1-(A=m/(a-1)),(T=i).x=_*_*n+2*_*A*u+A*A*c,T.y=_*_*E+2*_*A*y+A*A*b,r(g,d,i.x,i.y),g=i.x,d=i.y;break;case"C":for(var p=n,h=o,x=1;x<a;x++)t(n,o,u,v,s,f,c,l,x/(a-1),i),r(p,h,i.x,i.y),p=i.x,h=i.y}var E,y,b,A,T,_}))}var a="precision highp float;attribute vec2 aUV;varying vec2 vUV;void main(){vUV=aUV;gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",i="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){gl_FragColor=texture2D(tex,vUV);}",o=new WeakMap,c={premultipliedAlpha:!1,preserveDrawingBuffer:!0,antialias:!1,depth:!1};function l(e,t){var n=e.getContext?e.getContext("webgl",c):e,r=o.get(n);if(!r){let e=function(e){var t=i[e];if(!t&&!(t=i[e]=n.getExtension(e)))throw new Error(e+" not supported");return t},t=function(e,t){var r=n.createShader(t);return n.shaderSource(r,e),n.compileShader(r),r},c=function(r,i,o,c){if(!l[r]){var u={},v={},s=n.createProgram();n.attachShader(s,t(i,n.VERTEX_SHADER)),n.attachShader(s,t(o,n.FRAGMENT_SHADER)),n.linkProgram(s),l[r]={program:s,transaction:function(t){n.useProgram(s),t({setUniform:function(e,t){for(var r=[],a=arguments.length-2;a-- >0;)r[a]=arguments[a+2];var i=v[t]||(v[t]=n.getUniformLocation(s,t));n["uniform"+e].apply(n,[i].concat(r))},setAttribute:function(t,r,i,o,c){var l=u[t];l||(l=u[t]={buf:n.createBuffer(),loc:n.getAttribLocation(s,t),data:null}),n.bindBuffer(n.ARRAY_BUFFER,l.buf),n.vertexAttribPointer(l.loc,r,n.FLOAT,!1,0,0),n.enableVertexAttribArray(l.loc),a?n.vertexAttribDivisor(l.loc,o):e("ANGLE_instanced_arrays").vertexAttribDivisorANGLE(l.loc,o),c!==l.data&&(n.bufferData(n.ARRAY_BUFFER,c,i),l.data=c)}})}}}l[r].transaction(c)},f=function(e,t){v++;try{n.activeTexture(n.TEXTURE0+v);var r=u[e];r||(r=u[e]=n.createTexture(),n.bindTexture(n.TEXTURE_2D,r),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,n.NEAREST)),n.bindTexture(n.TEXTURE_2D,r),t(r,v)}finally{v--}},g=function(e,t,r){var a=n.createFramebuffer();s.push(a),n.bindFramebuffer(n.FRAMEBUFFER,a),n.activeTexture(n.TEXTURE0+t),n.bindTexture(n.TEXTURE_2D,e),n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0);try{r(a)}finally{n.deleteFramebuffer(a),n.bindFramebuffer(n.FRAMEBUFFER,s[--s.length-1]||null)}},d=function(){i={},l={},u={},v=-1,s.length=0};var a="undefined"!=typeof WebGL2RenderingContext&&n instanceof WebGL2RenderingContext,i={},l={},u={},v=-1,s=[];n.canvas.addEventListener("webglcontextlost",(function(e){d(),e.preventDefault()}),!1),o.set(n,r={gl:n,isWebGL2:a,getExtension:e,withProgram:c,withTexture:f,withTextureFramebuffer:g,handleContextLoss:d})}t(r)}function u(e,t,n,r,o,c,u,v){void 0===u&&(u=15),void 0===v&&(v=null),l(e,(function(e){var l=e.gl,s=e.withProgram;(0,e.withTexture)("copy",(function(e,f){l.texImage2D(l.TEXTURE_2D,0,l.RGBA,o,c,0,l.RGBA,l.UNSIGNED_BYTE,t),s("copy",a,i,(function(e){var t=e.setUniform;(0,e.setAttribute)("aUV",2,l.STATIC_DRAW,0,new Float32Array([0,0,2,0,0,2])),t("1i","image",f),l.bindFramebuffer(l.FRAMEBUFFER,v||null),l.disable(l.BLEND),l.colorMask(8&u,4&u,2&u,1&u),l.viewport(n,r,o,c),l.scissor(n,r,o,c),l.drawArrays(l.TRIANGLES,0,3)}))}))}))}var v=Object.freeze({__proto__:null,withWebGLContext:l,renderImageData:u,resizeWebGLCanvasWithoutClearing:function(e,t,n){var r=e.width,a=e.height;l(e,(function(i){var o=i.gl,c=new Uint8Array(r*a*4);o.readPixels(0,0,r,a,o.RGBA,o.UNSIGNED_BYTE,c),e.width=t,e.height=n,u(o,c,0,0,r,a)}))}});function s(e,t,n,a,i,o){void 0===o&&(o=1);var c=new Uint8Array(e*t),l=a[2]-a[0],u=a[3]-a[1],v=[];r(n,(function(e,t,n,r){v.push({x1:e,y1:t,x2:n,y2:r,minX:Math.min(e,n),minY:Math.min(t,r),maxX:Math.max(e,n),maxY:Math.max(t,r)})})),v.sort((function(e,t){return e.maxX-t.maxX}));for(var s=0;s<e;s++)for(var f=0;f<t;f++){var g=p(a[0]+l*(s+.5)/e,a[1]+u*(f+.5)/t),m=Math.pow(1-Math.abs(g)/i,o)/2;g<0&&(m=1-m),m=Math.max(0,Math.min(255,Math.round(255*m))),c[f*e+s]=m}return c;function p(e,t){for(var n=1/0,r=1/0,a=v.length;a--;){var i=v[a];if(i.maxX+r<=e)break;if(e+r>i.minX&&t-r<i.maxY&&t+r>i.minY){var o=d(e,t,i.x1,i.y1,i.x2,i.y2);o<n&&(n=o,r=Math.sqrt(n))}}return function(e,t){for(var n=0,r=v.length;r--;){var a=v[r];if(a.maxX<=e)break;a.y1>t!=a.y2>t&&e<(a.x2-a.x1)*(t-a.y1)/(a.y2-a.y1)+a.x1&&(n+=a.y1<a.y2?1:-1)}return 0!==n}(e,t)&&(r=-r),r}}function f(e,t,n,r,a,i,o,c,l,u){void 0===i&&(i=1),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),g(e,t,n,r,a,i,o,null,c,l,u)}function g(e,t,n,r,a,i,o,c,l,v,f){void 0===i&&(i=1),void 0===l&&(l=0),void 0===v&&(v=0),void 0===f&&(f=0);for(var g=s(e,t,n,r,a,i),d=new Uint8Array(4*g.length),m=0;m<g.length;m++)d[4*m+f]=g[m];u(o,d,l,v,e,t,1<<3-f,c)}function d(e,t,n,r,a,i){var o=a-n,c=i-r,l=o*o+c*c,u=l?Math.max(0,Math.min(1,((e-n)*o+(t-r)*c)/l)):0,v=e-(n+u*o),s=t-(r+u*c);return v*v+s*s}var m=Object.freeze({__proto__:null,generate:s,generateIntoCanvas:f,generateIntoFramebuffer:g}),p="precision highp float;uniform vec4 uGlyphBounds;attribute vec2 aUV;attribute vec4 aLineSegment;varying vec4 vLineSegment;varying vec2 vGlyphXY;void main(){vLineSegment=aLineSegment;vGlyphXY=mix(uGlyphBounds.xy,uGlyphBounds.zw,aUV);gl_Position=vec4(mix(vec2(-1.0),vec2(1.0),aUV),0.0,1.0);}",h="precision highp float;uniform vec4 uGlyphBounds;uniform float uMaxDistance;uniform float uExponent;varying vec4 vLineSegment;varying vec2 vGlyphXY;float absDistToSegment(vec2 point,vec2 lineA,vec2 lineB){vec2 lineDir=lineB-lineA;float lenSq=dot(lineDir,lineDir);float t=lenSq==0.0 ? 0.0 : clamp(dot(point-lineA,lineDir)/lenSq,0.0,1.0);vec2 linePt=lineA+t*lineDir;return distance(point,linePt);}void main(){vec4 seg=vLineSegment;vec2 p=vGlyphXY;float dist=absDistToSegment(p,seg.xy,seg.zw);float val=pow(1.0-clamp(dist/uMaxDistance,0.0,1.0),uExponent)*0.5;bool crossing=(seg.y>p.y!=seg.w>p.y)&&(p.x<(seg.z-seg.x)*(p.y-seg.y)/(seg.w-seg.y)+seg.x);bool crossingUp=crossing&&vLineSegment.y<vLineSegment.w;gl_FragColor=vec4(crossingUp ? 1.0/255.0 : 0.0,crossing&&!crossingUp ? 1.0/255.0 : 0.0,0.0,val);}",x="precision highp float;uniform sampler2D tex;varying vec2 vUV;void main(){vec4 color=texture2D(tex,vUV);bool inside=color.r!=color.g;float val=inside ? 1.0-color.a : color.a;gl_FragColor=vec4(val);}",E=new Float32Array([0,0,2,0,0,2]),y=null,b=!1,A={},T=new WeakMap;function _(e){if(!b&&!D(e))throw new Error("WebGL generation not supported")}function R(e,t,n,r,a,i,o){if(void 0===i&&(i=1),void 0===o&&(o=null),!o&&!(o=y)){var c="function"==typeof OffscreenCanvas?new OffscreenCanvas(1,1):"undefined"!=typeof document?document.createElement("canvas"):null;if(!c)throw new Error("OffscreenCanvas or DOM canvas not supported");o=y=c.getContext("webgl",{depth:!1})}_(o);var u=new Uint8Array(e*t*4);l(o,(function(o){var c=o.gl,l=o.withTexture,v=o.withTextureFramebuffer;l("readable",(function(o,l){c.texImage2D(c.TEXTURE_2D,0,c.RGBA,e,t,0,c.RGBA,c.UNSIGNED_BYTE,null),v(o,l,(function(o){U(e,t,n,r,a,i,c,o,0,0,0),c.readPixels(0,0,e,t,c.RGBA,c.UNSIGNED_BYTE,u)}))}))}));for(var v=new Uint8Array(e*t),s=0,f=0;s<u.length;s+=4)v[f++]=u[s];return v}function w(e,t,n,r,a,i,o,c,l,u){void 0===i&&(i=1),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0),U(e,t,n,r,a,i,o,null,c,l,u)}function U(e,t,n,i,o,c,u,v,s,f,g){void 0===c&&(c=1),void 0===s&&(s=0),void 0===f&&(f=0),void 0===g&&(g=0),_(u);var d=[];r(n,(function(e,t,n,r){d.push(e,t,n,r)})),d=new Float32Array(d),l(u,(function(n){var r=n.gl,l=n.isWebGL2,u=n.getExtension,m=n.withProgram,y=n.withTexture,b=n.withTextureFramebuffer,A=n.handleContextLoss;if(y("rawDistances",(function(n,y){e===n._lastWidth&&t===n._lastHeight||r.texImage2D(r.TEXTURE_2D,0,r.RGBA,n._lastWidth=e,n._lastHeight=t,0,r.RGBA,r.UNSIGNED_BYTE,null),m("main",p,h,(function(a){var v=a.setAttribute,s=a.setUniform,f=!l&&u("ANGLE_instanced_arrays"),g=!l&&u("EXT_blend_minmax");v("aUV",2,r.STATIC_DRAW,0,E),v("aLineSegment",4,r.DYNAMIC_DRAW,1,d),s.apply(void 0,["4f","uGlyphBounds"].concat(i)),s("1f","uMaxDistance",o),s("1f","uExponent",c),b(n,y,(function(n){r.enable(r.BLEND),r.colorMask(!0,!0,!0,!0),r.viewport(0,0,e,t),r.scissor(0,0,e,t),r.blendFunc(r.ONE,r.ONE),r.blendEquationSeparate(r.FUNC_ADD,l?r.MAX:g.MAX_EXT),r.clear(r.COLOR_BUFFER_BIT),l?r.drawArraysInstanced(r.TRIANGLES,0,3,d.length/4):f.drawArraysInstancedANGLE(r.TRIANGLES,0,3,d.length/4)}))})),m("post",a,x,(function(n){n.setAttribute("aUV",2,r.STATIC_DRAW,0,E),n.setUniform("1i","tex",y),r.bindFramebuffer(r.FRAMEBUFFER,v),r.disable(r.BLEND),r.colorMask(0===g,1===g,2===g,3===g),r.viewport(s,f,e,t),r.scissor(s,f,e,t),r.drawArrays(r.TRIANGLES,0,3)}))})),r.isContextLost())throw A(),new Error("webgl context lost")}))}function D(e){var t=e&&e!==y?e.canvas||e:A,n=T.get(t);if(void 0===n){b=!0;try{var r=[97,106,97,61,99,137,118,80,80,118,137,99,61,97,106,97],a=R(4,4,"M8,8L16,8L24,24L16,24Z",[0,0,32,32],24,1,e);(n=a&&r.length===a.length&&a.every((function(e,t){return e===r[t]})))||"bad trial run results"}catch(i){n=!1,i.message}b=!1,T.set(t,n)}return n}var L=Object.freeze({__proto__:null,generate:R,generateIntoCanvas:w,generateIntoFramebuffer:U,isSupported:D});return e.forEachPathCommand=n,e.generate=function(e,t,n,r,a,i){void 0===a&&(a=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===i&&(i=1);try{return R.apply(L,arguments)}catch(o){return s.apply(m,arguments)}},e.generateIntoCanvas=function(e,t,n,r,a,i,o,c,l,u){void 0===a&&(a=Math.max(r[2]-r[0],r[3]-r[1])/2),void 0===i&&(i=1),void 0===c&&(c=0),void 0===l&&(l=0),void 0===u&&(u=0);try{return w.apply(L,arguments)}catch(v){return f.apply(m,arguments)}},e.javascript=m,e.pathToLineSegments=r,e.webgl=L,e.webglUtils=v,Object.defineProperty(e,"__esModule",{value:!0}),e}({});return e}export{e as S};
